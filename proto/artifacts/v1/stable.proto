// Using edition 2023 - edition 2024 not yet fully supported by buf (as of v1.61.0)
// TODO: Upgrade to edition 2024 when buf/protoc fully support it
edition = "2023";

package artifacts.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/go_features.proto";
import "artifacts/v1/manifest.proto";

option go_package = "github.com/ConductorOne/github-workflows/pb/artifacts/v1";
option features.(pb.go).api_level = API_OPAQUE;

// Stable represents a stable release manifest with an additional updated_at timestamp.
// This manifest is stored at the catalog-level path: releases/{org}/{repo}/stable.json
// It contains the same structure as Manifest but includes when it was last updated.
message Stable {
  // version is the manifest schema version (currently "1")
  string version = 1;
  
  // name is the repository name (e.g., "baton-ukg")
  string name = 2;
  
  // org is the organization name (e.g., "ConductorOne")
  string org = 3;
  
  // semver is the semantic version tag (e.g., "v0.0.8")
  string semver = 4;
  
  // released_at is the timestamp when the release was created
  google.protobuf.Timestamp released_at = 5;
  
  // assets is a map of platform/type identifiers to asset metadata.
  // Keys are platform identifiers like "darwin-arm64", "linux-amd64", "windows-amd64", "checksums"
  map<string, Asset> assets = 6;
  
  // images is a map of platform identifiers to container image metadata.
  // Keys are platform identifiers like "index", "linux-amd64", "linux-arm64"
  map<string, Image> images = 7;
  
  // signature_href is the URL to the manifest signature file (manifest.json.sig)
  string signature_href = 8;
  
  // certificate_href is the URL to the manifest certificate file (manifest.json.cert)
  string certificate_href = 9;
  
  // updated_at is the timestamp when this stable release was last updated.
  // This differs from released_at which is when the original release was created.
  google.protobuf.Timestamp updated_at = 10;
}

